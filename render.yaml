services:
  # Backend Service
  - type: web
    name: linos-backend
    env: node
    region: oregon
    plan: starter
    buildCommand: yarn install && cd packages/backend && npx prisma generate && yarn build
    startCommand: cd packages/backend && node dist/main
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        value: file:/var/data/linos-panificadora.db
      - key: PDF_STORAGE_PATH
        value: /var/data/pdfs
      - key: UPLOADS_PATH
        value: /var/data
      - fromGroup: linos-secrets
    disk:
      name: data
      mountPath: /var/data
      sizeGB: 1

  # Frontend Service
  - type: web
    name: linos-frontend
    env: node
    region: oregon
    plan: starter
    buildCommand: yarn install && cd packages/frontend && yarn build
    startCommand: cd packages/frontend && yarn start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_API_URL
        value: https://linos-backend.onrender.com

envVarGroups:
  - name: linos-secrets
    envVars:
      - key: JWT_SECRET
        generateValue: true