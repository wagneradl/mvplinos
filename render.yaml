services:
  # Backend Service
  - type: web
    name: linos-backend
    env: node
    region: oregon
    plan: starter
    buildCommand: yarn install --ignore-scripts && node scripts/render-postinstall.js && node scripts/render-backend-build.js
    startCommand: cd packages/backend && node dist/main
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        value: file:/var/data/linos-panificadora.db
      - key: PDF_STORAGE_PATH
        value: /var/data/pdfs
      - key: UPLOADS_PATH
        value: /var/data
      - fromGroup: linos-secrets
    disk:
      name: data
      mountPath: /var/data
      sizeGB: 1

  # Frontend Service
  - type: web
    name: linos-frontend
    env: node
    region: oregon
    plan: starter
    buildCommand: >
      yarn install --ignore-scripts &&
      cd packages/frontend &&
      yarn add --dev typescript@5.0.4 @types/react@18.2.12 @types/react-dom@18.2.5 &&
      cd ../.. &&
      node scripts/render-advanced-fix.js
    startCommand: cd packages/frontend && yarn start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_API_URL
        value: https://linos-backend.onrender.com
      - key: NEXT_SKIP_TYPECHECKING
        value: "1"
      - key: NEXT_TELEMETRY_DISABLED
        value: "1"
      - key: NODE_OPTIONS
        value: "--max_old_space_size=4096"
      - key: TSC_COMPILE_ON_ERROR
        value: "true"

envVarGroups:
  - name: linos-secrets
    envVars:
      - key: JWT_SECRET
        generateValue: true